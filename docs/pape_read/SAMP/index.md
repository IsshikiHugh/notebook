# [SAMP] Stochastic Scene-Aware Motion Prediction

`3DV` `Human-Motion` `Scene-Aware`

!!! info "æ–‡ç« ä¿¡æ¯"
    - æ–‡ç« é¢˜ç›®ï¼š*Stochastic Scene-Aware Motion Prediction*
    - ä½œè€…ï¼š[Mohamed Hassan](https://mohamedhassanmus.github.io/), [Duygu Ceylan](http://www.duygu-ceylan.com/), [Ruben Villegas](https://rubenvillegas.github.io/), [Jun Saito](https://research.adobe.com/person/jun-saito/), [Jimei Yang](https://research.adobe.com/person/jimei-yang/), [Yi Zhou](https://research.adobe.com/person/yi-zhou/), and [Michael Black](https://ps.is.tuebingen.mpg.de/person/black)
    - é¡¹ç›®ä¸»é¡µï¼š[ğŸ”—](https://samp.is.tue.mpg.de/)
    - è®ºæ–‡ï¼š[ğŸ”—](https://ps.is.mpg.de/uploads_file/attachment/attachment/652/samp.pdf)
    - Demoï¼š[ğŸ”—](https://github.com/mohamedhassanmus/SAMP)
    - ä»£ç ï¼š[ğŸ”—](https://github.com/mohamedhassanmus/SAMP_Training)

---

## è®ºæ–‡ç¬”è®°

---

### é—®é¢˜ä¸ç°çŠ¶ä¸è„‰ç»œ

åŠ¨ä½œç”Ÿæˆçš„å®ç°åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

1. å¯¼èˆªè‡³äº¤äº’ç›®æ ‡ï¼›
2. å¯»æ‰¾äº¤äº’æ¥è§¦ç‚¹(contact point)ï¼›
3. ç”Ÿæˆäº¤äº’åŠ¨ä½œï¼Œå¹¶ä¸”éœ€è¦ä¿è¯ç”Ÿæˆç»“æœä¼šè‡ªç„¶å˜åŒ–ï¼ˆä»¥ç¬¦åˆç°å®æ„Ÿè§‰ï¼‰ï¼›

ç”±äºè¿™äº›åŠ¨ä½œä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯â€œå¾ªç¯çš„(cyclic)â€ï¼Œä¸€éƒ¨åˆ†æ˜¯â€œä¸å¾ªç¯çš„(acyclic)â€ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ¨ç†ç³»ç»Ÿæ¥åè°ƒä¸¤è€… -> æå‡º SAMPï¼Œåœºæ™¯å¯æ„ŸçŸ¥çš„åŠ¨ä½œé¢„æµ‹ç³»ç»Ÿ(Scene-Aware Motion Prediction)ï¼š

- éšæœºæ¨¡å‹
- è¾“å…¥ 3D åœºæ™¯
- é‡‡æ ·æœ‰æ•ˆäº¤äº’ç›®æ ‡
- ç”Ÿæˆç›®æ ‡é™åˆ¶çš„ã€åœºæ™¯æ„ŸçŸ¥çš„ã€é€¼çœŸçš„äººä½“åŠ¨ä½œåºåˆ—

---

### è´¡çŒ®

1. æ–°é¢–çš„éšæœºæ¨¡å‹ä»¥ç”Ÿæˆ**å®æ—¶**çš„ã€å¤šæ ·çš„ã€**goal driven** çš„äººç‰©å¯¹åœºæ™¯çš„äº¤äº’ï¼›
2. ï¼ˆå¯¹ 1. çš„ç»†åŒ–ï¼‰ç»™å®šç›®æ ‡å‡ ä½•ä½“åç”Ÿæˆå¯ä¿¡çš„ã€åŠ¨ä½œç›¸å…³çš„äº¤äº’ä½ç½®å’Œæ–¹å‘çš„æ–°å»ºæ¨¡æ–¹æ³•ï¼›
3. ï¼ˆå¯¹ 1. çš„ç»†åŒ–ï¼‰å°†å…·ä½“è·¯å¾„è§„åˆ’çº³å…¥å˜åˆ†è¿åŠ¨åˆæˆç½‘ç»œï¼Œå®ç°åœ¨å¤æ‚åœºæ™¯ä¸­çš„å¯¼èˆªï¼›
4. åŒ…å«å¤šæ ·äººä½“åœºæ™¯äº¤äº’æ•°æ®çš„æ–°çš„ MoCap æ•°æ®é›†ï¼›

---

### æ–¹æ³•ã€€

- `MotionNet`(core)ï¼šä¸€ä¸ª cVAEï¼Œ**è¾“å…¥**ç›®æ ‡å¯¹è±¡å’ŒåŠ¨ä½œï¼Œ`MotionNet` æ¯ä¸€å¸§å°†**é‡‡æ ·**ä¸€ä¸ªæ½œå‘é‡ï¼Œè”åˆå‰ä¸€å¸§çš„åŠ¨ä½œæ¥æ§åˆ¶ï¼ˆå³**é¢„æµ‹**ï¼‰ä¸‹ä¸€ä¸ªåŠ¨ä½œï¼›
	- åŒ…å«ä¸€ä¸ª encoder å’Œä¸€ä¸ª decoderï¼›  ![](assets/20230720095453.png)
	- $X_i$ è¡¨ç¤ºç¬¬ $i$ æ—¶åˆ»çš„çŠ¶æ€ï¼Œ$Z$ ä¸ºç”Ÿæˆçš„æ½œå‘é‡ï¼Œ$I$ ä¸ºäº¤äº’å¯¹è±¡(interaction objects)ï¼ˆä»¥**äººç‰©ä¸ºåŸç‚¹**çš„ä½“ç´ ç©ºé—´è¡¨è¾¾ï¼‰ï¼›
		- encoder åŒ…å« Interaction Encoder å’Œ State Encoderï¼Œåˆ†åˆ«å°† $I$ å’Œ $X$ ç¼–ç ï¼ˆä½¿ç”¨ 3 ä¸ª FCï¼‰ä¸ºä½ç»´åº¦å‘é‡ï¼Œå†æ‹¼æ¥èµ·æ¥è¾“å…¥åˆ°ä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„ FC ä¸­ä»¥é¢„æµ‹ $\mu$ å’Œ $\sigma$ å³ä¸€ä¸ªæ½œåµŒå…¥ç©ºé—´(latent embedding space)ï¼›
		- äºæ˜¯æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸Šè¿°ç»“æœä¸ºå‚æ•°çš„é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·å‡ºæ½œå‘é‡ $Z$ ä½œä¸º decoder çš„è¾“å…¥ï¼› ![](assets/20230720100605.png)
		- [x] **é—®é¢˜**ï¼šä¸ºä»€ä¹ˆè¿™é‡Œçš„ $j^r_i$ æ˜¯ 6d çš„ï¼Ÿï¼ˆå®é™…ä¸Šæ˜¯ 9d æ—‹è½¬çŸ©é˜µä¸­ä¼šå˜å…ƒæœ‰ 6 ä¸ªï¼Œé€šè¿‡è¿™ä¸ª 6d çš„å‘é‡èƒ½å¤Ÿè¿˜åŸå‡ºè¿™ä¸ªçŸ©é˜µï¼Œè€Œè‡³äºä¸ºä»€ä¹ˆç”¨è¿™ä¸ª 6d å†…å®¹è€Œéè§’åº¦ï¼Œå¯ä»¥å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](https://arxiv.org/abs/1812.07035)ï¼Œè§’åº¦å…·æœ‰çªå˜ä¸è¿ç»­ï¼š$2pi = 0$ï¼Œæ‰€ä»¥éƒ½ä¸æ€ä¹ˆç”¨äº†ï¼‰
		- decoder æ˜¯ä¸€ä¸ª MoEï¼Œæœ‰ Prediction Network å’Œ Gating Network ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰è€…è´Ÿè´£ç”Ÿæˆé¢„æµ‹ç»“æœï¼Œåè€…è´Ÿè´£ç”Ÿæˆå„ä¸ªä¸“å®¶ç½‘ç»œçš„ç»“æœåˆæˆè¿‡ç¨‹ä¸­çš„æƒé‡ï¼›
	- ä½¿ç”¨çš„ loss ä¸º $||\hat{X_i} - X_i||^2_2 + \beta_1\mathop{KL}(Q(Z|X_i, X_{i-1}, I) || p(Z))$ï¼›
	- ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…ä»æ ‡å‡†æ­£æ€åˆ†å¸ƒä¸­é‡‡æ ·æ½œå‘é‡ï¼›
		- [x] **é—®é¢˜**ï¼šä¸ºä»€ä¹ˆï¼Ÿ
- `GoalNet`ï¼šç”¨æ¥ç”Ÿæˆäº¤äº’ç‚¹å’Œäº¤äº’æ–¹å‘(contact points and orientations)ï¼Œå³ç›®æ ‡(goals)ï¼›
	- è¯¥æ¨¡å—è®© SAMP èƒ½å¤Ÿé€‚åº”ä¸åŒçš„ç›®æ ‡å‡ ä½•ä½“ï¼›
	- åŒæ ·åŒ…å«ä¸€ä¸ª encoder å’Œä¸€ä¸ª decoderï¼›  ![](assets/20230720101937.png)
	 - $I$ ä¸ºäº¤äº’å¯¹è±¡(interaction objects)ï¼ˆä»¥ç‰©ä½“**è‡ªèº«ä¸ºåŸç‚¹**çš„ä½“ç´ ç©ºé—´è¡¨è¾¾ï¼‰ï¼Œ$\{g^p, g^d\}$ åˆ†åˆ«ä¸ºç›®æ ‡(goal)çš„ä½ç½®å’Œæ–¹å‘ï¼Œ$Z_{goal}$ ä¸ºæ½œå‘é‡ï¼›
	 - ä½¿ç”¨çš„ loss ä¸º $||\hat{g}^p - g^p||^2_2 + ||\hat{g}^d - g^d||^2_2 + \beta_2 \mathop{KL}(Q(Z_{goal}|g^p, g^d, I) || p(Z_{goal}))$ï¼›
-  `Path Planning Module`ï¼šä½¿ç”¨ A* å¯»è·¯ä»¥é¿éšœ(obstacles)ï¼›
	- ç”Ÿæˆçš„è·¯çº¿ä¸­å°†ä¼šæœ‰è®¸å¤šè·¯ç‚¹(way-points)ä½œä¸º**è¿‡ç¨‹ä¸­çš„**ç›®æ ‡ç‚¹(goals)ï¼›
	- explicit A*ï¼›
	- æ‰€è°“çš„â€œè·¯å¾„â€ï¼Œå…·ä½“æŒ‡çš„æ˜¯ä¸€ç³»åˆ—è·¯ç‚¹(way point)ï¼Œé€šè¿‡è¿™äº›â€œå°ç›®æ ‡â€ï¼Œæ¥ä¸€æ­¥æ­¥å¼•å¯¼è™šæ‹Ÿäººåˆ°è¾¾ç›®æ ‡å‰ï¼Œåœ¨æœ€åä¸€ä¸ªè·¯ç‚¹è¿›è¡Œç›®æ ‡åŠ¨ä½œçš„ç”Ÿæˆï¼›
	- è¿™ä¸€æ–¹é¢ä¸ NSM ä½¿ç”¨ sensor æ£€æµ‹ä¸åŒï¼Œæ›´åŠ é«˜æ•ˆï¼›

> è¿™äº›ç‹¬ç«‹ç»„ä»¶ä½¿ SAMP ç§°ä¸ºç¬¬ä¸€ä¸ªè§£å†³ç”Ÿæˆå¤šæ ·åŠ¨æ€åŠ¨ä½œåºåˆ—ï¼Œå¹¶ä¸”èƒ½çœŸå®åº”ç”¨äºå¤æ‚åœºæ™¯ä¸­çš„ã€‚
- [x] **é—®é¢˜**ï¼šè¿™é‡Œæœ€å…³é”®çš„æ˜¯å“ªä¸€ä¸ªéƒ¨åˆ†ï¼Ÿä¸ NSM ç›¸æ¯”ç‹¬åˆ›æ€§çš„åœ°æ–¹å…·ä½“åœ¨å“ªé‡Œï¼Ÿåˆ°åº•å¦‚ä½•å®šä¹‰â€œdiverse human-scene interactionsâ€ï¼Œå’Œ Motion VAE é‚£ç§ç”Ÿæˆåˆ†å¸ƒæ¨¡å‹çš„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆMotion VAE æ˜¯åˆ©ç”¨åˆ†å¸ƒçš„æå¤§ä¼¼ç„¶ä¼°è®¡å¾—åˆ°ç»“æœçš„ï¼ŒMoGlow è²Œä¼¼å’Œåœºæ™¯æ²¡å…³ç³»ï¼‰

å› æ­¤ï¼Œè®­ç»ƒ SAMP æ‰€éœ€çš„æ•°æ®é›†éœ€è¦ä¸°å¯Œä¸”ä¸åŒçš„åœºæ™¯äº¤äº’ï¼Œç°æœ‰æ•°æ®é›†ç¼ºå°‘äº¤äº’è¡Œä¸º -> è‡ªå·±åšäº†ä¸€ä¸ªã€‚

- [x] **é—®é¢˜**ï¼štrajectory å’Œ path å’Œ pose çš„åŒºåˆ«ï¼Ÿæ˜¯æŒ‡åŒ…æ‹¬äº†åŠ¨ä½œå’Œè¡ŒåŠ¨è·¯çº¿çš„è½¨è¿¹å—ï¼Ÿ

å¦‚ä½•è¡¡é‡äººä½“åŠ¨ä½œçš„éšæœºæ€§(stochasticity)æ˜¯ä¸€ä¸ªæœ‰å¾…æ¢ç´¢çš„é¢†åŸŸã€‚

---

### è®­ç»ƒç­–ç•¥

ä½¿ç”¨æ­£å¸¸çš„ç›‘ç£è®­ç»ƒä¼šå¯¼è‡´é”™è¯¯ç´¯ç§¯(accumulation of error)ï¼Œå› ä¸ºä¸€æ¬¡çš„è¾“å‡ºä¼šä½œä¸ºè¾“å…¥è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªç½‘ç»œã€‚æ‰€ä»¥ SAMP é‡‡ç”¨é¢„è®¢é‡‡æ ·(scheduled sampling)ï¼Œå®ƒèƒ½å¤Ÿç¨³å®šç”Ÿæˆé•¿æ—¶é—´çš„åŠ¨ä½œé¢„ä¼°ã€‚

å…·ä½“æ¥è¯´ï¼Œä¸Šä¸€æ¬¡çš„é¢„æµ‹ç»“æœä»¥ $1-P$ çš„æ¦‚ç‡ä½œä¸ºä¸‹ä¸€æ¬¡é¢„æµ‹çš„è¾“å…¥ï¼Œå…¶ä¸­ $P$ çš„å®šä¹‰å¦‚ä¸‹ï¼š
![](assets/20230720104704.png)

---

### å®éªŒå’Œè¯„ä¼°

åœ¨åŒåˆå§‹æ¡ä»¶ä¸‹å¤šæ¬¡æ‰§è¡ŒåŒä¸€ä»»åŠ¡ï¼Œä½¿ç”¨ APD(Average Pairwise Distance) æ¥è¡¡é‡å…¶è¿åŠ¨å¹…åº¦ï¼š
![](assets/20230720105214.png)


---

## ä»£ç é˜…è¯»

### MotionNet

å…¬å¼æ¨å¯¼ï¼š

!!! note "æ­£æ€åˆ†å¸ƒçš„ç†µå…¬å¼"
    å‡è®¾ $x\sim N(\mu, \sigma^2)$ï¼Œäºæ˜¯æœ‰ï¼š

    $$
    p(x) = \frac{1}{\sqrt{2\pi \sigma^2}}   \exp\left[
        -\frac{(x-\mu)^2}{2\sigma^2}
    \right]
    $$
    å¹¶ä¸”æœ‰ç»“è®ºï¼š

    $$
    \int_{-\infty}^{\infty} e^{-x^2} \mathrm{d}x = \sqrt{\pi}
    $$

    é‚£ä¹ˆæœ‰å…¶ç†µå…¬å¼ï¼š

    $$
    \begin{aligned}
        -\int_{-\infty}^{\infty} p(x)\ln p(x) \mathrm{d}x
        &=
        -\int_{-\infty}^{\infty}\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(
            -\frac{(x-\mu)^2}{\sqrt{2\sigma^2}} 
        \right)
        \ln\left[
        \frac{1}{\sqrt{2\pi\sigma^2}} \exp\left(
            -\frac{(x-\mu)^2}{2\sigma^2}
        \right)
        \right]
        \mathrm{d}x \\
        &= 
        \frac{1}{2}\left(
            \ln\left(
                2\pi\sigma^2
            \right) + 1
        \right)
    \end{aligned}
    $$

